"use strict";(self.webpackChunkgreen_public=self.webpackChunkgreen_public||[]).push([[8534],{38534:(Es,F,s)=>{s.d(F,{ReviewWorkflowsCreatePage:()=>q});var t=s(74081),i=s(27279),H=s(48102),h=s(10701),N=s(77970),A=s(32370),E=s(15530),Y=s(59082),Z=s(53532),L=s(71563),z=s(43433),Q=s(61020),V=s(40464),d=s(59461),$=s(51447),G=s(87137),J=s(59491),e=s(90947),X=s(74563),P=s(85405),r=s(9991),O=s(47706),b=s(60625),ds=s(24468),Ms=s(15816),Ds=s(97442),Ps=s(13576),Os=s(87830),gs=s(47184),fs=s(364),vs=s(49204),ms=s(47853),cs=s(74919),hs=s(29206),Ls=s(98934),Cs=s(75719),Ts=s(8175),Rs=s(6078),Ws=s(51943),Is=s(55783),As=s(92249),Bs=s(41942),Ks=s(22919),Us=s(53915),us=s(75041),ws=s(30200),ys=s(91379),js=s(33299),xs=s(33409),ps=s(63645),Ss=s(7988),ks=s(7055),Fs=s(26757),Hs=s(58311),Ns=s(29510),Ys=s(16946),Zs=s(10124),zs=s(69530),Qs=s(86961),Vs=s(51527),$s=s(19764),Gs=s(42982),Js=s(26126),Xs=s(93836);const q=()=>{const{formatMessage:a}=(0,Q.Z)(),{post:ss}=(0,E.kY)(),{push:ts}=(0,$.k6)(),{formatAPIError:os}=(0,E.So)(),l=(0,d.I0)(),g=(0,E.lm)(),{collectionTypes:B,singleTypes:K,isLoading:C}=(0,J.u)(),{isLoading:f,meta:U,workflows:v}=(0,b.u)(),{isLoading:T,roles:u}=(0,G.u)(void 0,{retry:!1}),m=(0,d.v9)(e.s),es=(0,d.v9)(e.a),n=(0,d.v9)(e.b),w=(0,d.v9)(e.c),[y,M]=i.useState(null),{isLoading:j,getFeature:as}=(0,X.u)(),[ns,_s]=i.useState(),[x,R]=i.useState({}),c=as("review-workflows"),p=c?.[O.C],D=c?.[O.a],S=v?.flatMap(o=>o.contentTypes),{mutateAsync:ls}=(0,V.useMutation)(async({workflow:o})=>{const{data:{data:_}}=await ss("/admin/review-workflows/workflows",{data:o});return _},{onSuccess(){g({type:"success",message:{id:"Settings.review-workflows.create.page.notification.success",defaultMessage:"Workflow successfully created"}})}}),k=async()=>{R({});try{const o=await ls({workflow:n});return ts(`/settings/review-workflows/${o.id}`),o}catch(o){if(o instanceof Z.d7)return o.response?.data?.error?.name==="ValidationError"&&o.response?.data?.error?.details?.errors?.length>0&&_s((o.response?.data?.error?.details?.errors).reduce((_,I)=>(I.path&&z(_,I.path,I.message),_),{})),g({type:"warning",message:os(o)}),null}},is=async()=>{await k()},rs=()=>{R({})},W=(0,L.TA)({enableReinitialize:!0,initialErrors:ns,initialValues:n,async onSubmit(){const o=n.contentTypes?.some(_=>S?.includes(_));U&&p&&U?.workflowCount>=parseInt(p,10)?M("workflow"):n.stages&&D&&n.stages.length>=parseInt(D,10)?M("stage"):o?R(_=>({..._,hasReassignedContentTypes:!0})):k()},validate(o){return(0,e.v)({values:o,formatMessage:a})}});return(0,e.u)(O.R,e.i),i.useEffect(()=>{l((0,e.r)()),!f&&v&&l((0,e.d)({workflows:v})),C||l((0,e.e)({collectionTypes:B,singleTypes:K})),T||l((0,e.f)(u)),l((0,e.g)(C||T)),l((0,e.h)({name:""}))},[B,l,C,T,f,u,K,v]),i.useEffect(()=>{!f&&!j&&n.stages&&c?.[O.a]&&D&&n.stages.length>=parseInt(D,10)&&M("stage")},[j,f,c,n.stages,D]),i.useEffect(()=>{!m&&w?.length===0&&g({blockTransition:!0,type:"warning",message:a({id:"Settings.review-workflows.stage.permissions.noPermissions.description",defaultMessage:"You don\u2019t have the permission to see roles"})})},[a,m,w,g]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(P.D,{}),(0,t.jsx)(L.Hy,{value:W,children:(0,t.jsxs)(L.l0,{onSubmit:W.handleSubmit,children:[(0,t.jsx)(P.H,{navigationAction:(0,t.jsx)(P.B,{href:"/settings/review-workflows"}),primaryAction:(0,t.jsx)(H.z,{startIcon:(0,t.jsx)(Y.Z,{}),type:"submit",size:"M",disabled:!es,children:a({id:"global.save",defaultMessage:"Save"})}),title:a({id:"Settings.review-workflows.create.page.title",defaultMessage:"Create Review Workflow"}),subtitle:a({id:"Settings.review-workflows.page.subtitle",defaultMessage:"{count, plural, one {# stage} other {# stages}}"},{count:n?.stages?.length??0})}),(0,t.jsx)(P.R,{children:(0,t.jsx)(h.k,{alignItems:"stretch",direction:"column",gap:7,children:m?(0,t.jsx)(N.a,{children:a({id:"Settings.review-workflows.page.isLoading",defaultMessage:"Workflow is loading"})}):(0,t.jsxs)(h.k,{alignItems:"stretch",direction:"column",gap:7,children:[(0,t.jsx)(e.W,{}),(0,t.jsx)(e.S,{stages:W.values?.stages})]})})})]})}),(0,t.jsx)(E.QH.Root,{isConfirmButtonLoading:m,isOpen:Object.keys(x).length>0,onToggleDialog:rs,onConfirm:is,children:(0,t.jsx)(E.QH.Body,{children:(0,t.jsxs)(h.k,{direction:"column",gap:5,children:[x.hasReassignedContentTypes&&(0,t.jsx)(A.Z,{textAlign:"center",variant:"omega",children:a({id:"Settings.review-workflows.page.delete.confirm.contentType.body",defaultMessage:"{count} {count, plural, one {content-type} other {content-types}} {count, plural, one {is} other {are}} already mapped to {count, plural, one {another workflow} other {other workflows}}. If you save changes, {count, plural, one {this} other {these}} {count, plural, one {content-type} other {{count} content-types}} will no more be mapped to the {count, plural, one {another workflow} other {other workflows}} and all corresponding information will be removed."},{count:S?.filter(o=>n.contentTypes?.includes(o)).length})}),(0,t.jsx)(A.Z,{textAlign:"center",variant:"omega",children:a({id:"Settings.review-workflows.page.delete.confirm.confirm",defaultMessage:"Are you sure you want to save?"})})]})})}),(0,t.jsxs)(r.L.Root,{isOpen:y==="workflow",onClose:()=>M(null),children:[(0,t.jsx)(r.L.Title,{children:a({id:"Settings.review-workflows.create.page.workflows.limit.title",defaultMessage:"You\u2019ve reached the limit of workflows in your plan"})}),(0,t.jsx)(r.L.Body,{children:a({id:"Settings.review-workflows.create.page.workflows.limit.body",defaultMessage:"Delete a workflow or contact Sales to enable more workflows."})})]}),(0,t.jsxs)(r.L.Root,{isOpen:y==="stage",onClose:()=>M(null),children:[(0,t.jsx)(r.L.Title,{children:a({id:"Settings.review-workflows.create.page.stages.limit.title",defaultMessage:"You have reached the limit of stages for this workflow in your plan"})}),(0,t.jsx)(r.L.Body,{children:a({id:"Settings.review-workflows.create.page.stages.limit.body",defaultMessage:"Try deleting some stages or contact Sales to enable more stages."})})]})]})}}}]);
